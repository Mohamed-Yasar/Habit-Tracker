<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Interactive Habit Tracker - November (Smart)</title>

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet" />

  <style>
    body {
      font-family: 'Inter', sans-serif;
      background-color: #f3f4f6;
      color: #374151;
    }
    ::-webkit-scrollbar {
      height: 8px;
      width: 8px;
    }
    ::-webkit-scrollbar-track {
      background: #f1f1f1;
    }
    ::-webkit-scrollbar-thumb {
      background: #c1c1c1;
      border-radius: 4px;
    }
    ::-webkit-scrollbar-thumb:hover {
      background: #a8a8a8;
    }
    .checkbox-cell {
      transition: all 0.2s ease;
    }
    .checkbox-cell:hover {
      background-color: #e5e7eb;
    }
    .checkbox-check {
      transition: transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
    }
    .checked .checkbox-check {
      transform: scale(1);
    }
    .unchecked .checkbox-check {
      transform: scale(0);
    }
    path {
      transition: d 0.5s ease;
    }
    input[type="number"]::-webkit-inner-spin-button,
    input[type="number"]::-webkit-outer-spin-button {
      appearance: none;
      margin: 0;
    }
  </style>
</head>

<body class="p-4 md:p-8 min-h-screen flex justify-center">

<div id="app"
     class="bg-white shadow-xl rounded-xl w-full max-w-[1400px] overflow-hidden flex flex-col border border-gray-200">

  <!-- HEADER -->
  <header class="bg-gray-100 p-6 border-b border-gray-300 flex flex-col md:flex-row items-center justify-between gap-6">
    <h1 class="text-4xl font-bold text-gray-600 tracking-tight">November</h1>

    <div class="flex gap-8 items-center text-sm font-medium text-gray-600">
      <div class="text-center">
        <div class="text-xs text-gray-500 uppercase">Number of habits</div>
        <div class="text-xl font-bold" id="total-habits-count">10</div>
      </div>

      <div class="text-center">
        <div class="text-xs text-gray-500 uppercase">Completed habits</div>
        <div class="text-xl font-bold" id="completed-habits-count">0</div>
      </div>

      <div class="w-64">
        <div class="flex justify-between text-xs mb-1">
          <span>Progress</span>
          <span id="header-progress-text">0%</span>
        </div>
        <div class="h-4 bg-gray-300 rounded-sm overflow-hidden border border-gray-400">
          <div id="header-progress-bar"
               class="h-full bg-green-400 transition-all duration-500"
               style="width: 0%"></div>
        </div>
      </div>

      <div class="text-center">
        <div class="text-xs text-gray-500 uppercase">Progress in %</div>
        <div class="text-xl font-bold" id="header-progress-percent">0%</div>
      </div>
    </div>
  </header>

  <!-- MAIN CONTENT AREA -->
  <div class="flex flex-col lg:flex-row">

    <!-- LEFT: GRID & CHARTS -->
    <div class="flex-grow overflow-x-auto">
      <div class="min-w-[1000px] p-4">

        <!-- HABIT GRID -->
        <div class="grid" style="grid-template-columns: 200px repeat(30, 1fr);">
          <!-- Week Row -->
          <div class="bg-gray-200 border border-gray-300 p-2 font-bold text-gray-700 flex items-center pl-4">
            My Habits
          </div>
          <div class="col-span-7 bg-gray-100 border border-gray-300 text-center text-xs text-gray-500 py-1">Week 1</div>
          <div class="col-span-7 bg-gray-100 border border-gray-300 text-center text-xs text-gray-500 py-1">Week 2</div>
          <div class="col-span-7 bg-gray-100 border border-gray-300 text-center text-xs text-gray-500 py-1">Week 3</div>
          <div class="col-span-9 bg-gray-100 border border-gray-300 text-center text-xs text-gray-500 py-1">Week 4</div>

          <!-- Days Row -->
          <div class="bg-gray-50 border-r border-gray-300"></div>
          <div id="days-header-row" class="contents"></div>

          <!-- Habit rows -->
          <div id="habits-container" class="contents"></div>

          <!-- Summary rows -->
          <div class="bg-gray-300 border border-gray-400 p-2 text-sm font-bold text-gray-700 pl-4 flex items-center">
            Progress
          </div>
          <div id="daily-progress-row" class="contents"></div>

          <div class="bg-gray-200 border border-gray-300 p-1 text-xs text-gray-600 pl-4 flex items-center">
            Done
          </div>
          <div id="daily-done-row" class="contents"></div>

          <div class="bg-gray-200 border border-gray-300 p-1 text-xs text-gray-600 pl-4 flex items-center">
            Not Done
          </div>
          <div id="daily-not-done-row" class="contents"></div>
        </div>

        <!-- GREEN PROGRESS CHART -->
        <div class="mt-6 border border-gray-400 bg-white h-48 relative rounded-sm overflow-hidden">
          <svg id="progress-chart" class="w-full h-full" preserveAspectRatio="none"></svg>
          <div class="absolute left-2 top-2 text-xs text-gray-400">100%</div>
          <div class="absolute left-2 top-1/2 -translate-y-1/2 text-xs text-gray-400">50%</div>
          <div class="absolute left-2 bottom-2 text-xs text-gray-400">0%</div>
        </div>

        <!-- MENTAL STATE TABLE -->
        <div class="mt-6">
          <div class="bg-gray-200 text-center text-sm font-bold text-gray-600 py-1 border border-gray-300">
            Mental State
          </div>

          <div class="grid" style="grid-template-columns: 200px repeat(30, 1fr);">
            <div class="bg-gray-100 border border-gray-300 p-2 text-sm text-gray-700 pl-4 flex items-center">
              Mood
            </div>
            <div id="mood-row" class="contents"></div>

            <div class="bg-gray-100 border border-gray-300 p-2 text-sm text-gray-700 pl-4 flex items-center">
              Motivation
            </div>
            <div id="motivation-row" class="contents"></div>
          </div>
        </div>

        <!-- PINK MENTAL CHART -->
        <div class="mt-2 border border-gray-400 bg-white h-40 relative rounded-sm overflow-hidden">
          <svg id="mental-chart" class="w-full h-full" preserveAspectRatio="none"></svg>
          <div class="absolute left-2 top-2 text-xs text-gray-400">10</div>
          <div class="absolute left-2 bottom-2 text-xs text-gray-400">0</div>
        </div>

      </div>
    </div>

    <!-- RIGHT: ANALYSIS SIDEBAR -->
    <div class="w-full lg:w-64 bg-gray-50 border-l border-gray-300 p-4 flex-shrink-0">
      <h2 class="text-xl font-bold text-gray-700 text-center mb-4">Analysis</h2>

      <div class="grid grid-cols-[1fr_1fr_2fr] gap-y-2 text-xs mb-2 font-bold text-gray-500 border-b border-gray-300 pb-2">
        <div class="text-center">Goal</div>
        <div class="text-center">Actual</div>
        <div>Progress</div>
      </div>

      <div id="analysis-container" class="space-y-2"></div>
    </div>

  </div>
</div>

<script>
  // ---------- CONFIG ----------
  const YEAR = 2025;
  const MONTH_NUMBER = 11;       // November
  const DAYS_IN_MONTH = 30;
  const WEEK_DAYS = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
  const STORAGE_KEY = 'habitTracker_nov2025_v1';

  const habitConfig = [
    { name: "Wake up at 08:00 ‚è∞", goal: 30 },
    { name: "Gym üí™", goal: 30 },
    { name: "Reading / Learning üìñ", goal: 30 },
    { name: "3 litre water", goal: 30 },
    { name: "Sleep at 12:00", goal: 30 },
    //{ name: "Project Work ‚öôÔ∏è", goal: 30 },
    //{ name: "No Alcohol üåø", goal: 30 },
    //{ name: "Social Media Detox üìµ", goal: 30 },
    //{ name: "Goal Journaling üìî", goal: 30 },
    //{ name: "Cold Shower üöø", goal: 30 }
  ];

  function getMonthWeekdays(year, month, daysInMonth) {
    const weekdays = [];
    for (let day = 1; day <= daysInMonth; day++) {
      const date = new Date(year, month - 1, day);
      weekdays.push(date.getDay()); // 0..6
    }
    return weekdays;
  }

  // ---------- STATE ----------
  let habitsData;
  let mentalData;

  function createDefaultState() {
    const habits = habitConfig.map(h => ({
      ...h,
      days: Array(DAYS_IN_MONTH).fill(false)
    }));
    const mental = {
      mood: Array(DAYS_IN_MONTH).fill(5),
      motivation: Array(DAYS_IN_MONTH).fill(5)
    };
    return { habits, mental };
  }

  function loadState() {
    try {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (!raw) throw new Error('no data');
      const parsed = JSON.parse(raw);

      // extra safety: if shape is wrong, reset
      if (!parsed ||
          !Array.isArray(parsed.habits) ||
          !parsed.mental ||
          !Array.isArray(parsed.mental.mood) ||
          !Array.isArray(parsed.mental.motivation)) {
        throw new Error('bad shape');
      }
      habitsData = parsed.habits;
      mentalData = parsed.mental;
    } catch (e) {
      console.warn('Resetting state for November:', e.message);
      const def = createDefaultState();
      habitsData = def.habits;
      mentalData = def.mental;
      saveState();
    }
  }

  function saveState() {
    try {
      localStorage.setItem(
        STORAGE_KEY,
        JSON.stringify({ habits: habitsData, mental: mentalData })
      );
    } catch (e) {
      console.error('Failed to save state', e);
    }
  }

  // ---------- DOM ----------
  const els = {
    daysHeader: document.getElementById('days-header-row'),
    habitsContainer: document.getElementById('habits-container'),
    dailyProgress: document.getElementById('daily-progress-row'),
    dailyDone: document.getElementById('daily-done-row'),
    dailyNotDone: document.getElementById('daily-not-done-row'),
    analysisContainer: document.getElementById('analysis-container'),
    moodRow: document.getElementById('mood-row'),
    motivationRow: document.getElementById('motivation-row'),

    totalHabits: document.getElementById('total-habits-count'),
    completedHabits: document.getElementById('completed-habits-count'),
    headerProgressBar: document.getElementById('header-progress-bar'),
    headerProgressText: document.getElementById('header-progress-text'),
    headerProgressPercent: document.getElementById('header-progress-percent'),

    progressChart: document.getElementById('progress-chart'),
    mentalChart: document.getElementById('mental-chart')
  };

  // ---------- RENDER ----------
  function renderGridStructure() {
    const weekdaysArray = getMonthWeekdays(YEAR, MONTH_NUMBER, DAYS_IN_MONTH);

    let daysHTML = "";
    for (let i = 1; i <= DAYS_IN_MONTH; i++) {
      const weekdayIndex = weekdaysArray[i - 1];
      const dayName = WEEK_DAYS[weekdayIndex];
      daysHTML += `
        <div class="border border-gray-300 bg-gray-50 text-center py-1">
          <div class="text-[10px] text-gray-500">${dayName}</div>
          <div class="text-xs font-bold text-gray-700">${i}</div>
        </div>`;
    }
    els.daysHeader.innerHTML = daysHTML;

    let habitsHTML = "";
    habitsData.forEach((habit, hIndex) => {
      habitsHTML += `
        <div class="bg-gray-100 border border-gray-300 p-2 text-xs font-medium text-gray-800 flex items-center pl-4 truncate">
          ${habit.name}
        </div>`;
      habit.days.forEach((checked, dIndex) => {
        habitsHTML += `
          <div class="border border-gray-300 bg-white flex items-center justify-center cursor-pointer checkbox-cell ${checked ? 'checked' : 'unchecked'}"
               onclick="toggleHabit(${hIndex}, ${dIndex})">
            <div class="w-5 h-5 rounded-sm border-2 ${checked ? 'bg-gray-600 border-gray-600' : 'bg-white border-gray-300'} flex items-center justify-center checkbox-check">
              ${checked
                ? '<svg class="w-3 h-3 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg>'
                : ''}
            </div>
          </div>`;
      });
    });
    els.habitsContainer.innerHTML = habitsHTML;
  }

  function renderMentalStateInputs() {
    let moodHTML = "";
    mentalData.mood.forEach((val, i) => {
      moodHTML += `
        <div class="border border-gray-300 bg-white flex items-center justify-center">
          <input type="number" min="1" max="10" value="${val}"
                 class="w-full h-full text-center text-xs focus:outline-none focus:bg-blue-50"
                 onchange="updateMentalState('mood', ${i}, this.value)">
        </div>`;
    });
    els.moodRow.innerHTML = moodHTML;

    let motivationHTML = "";
    mentalData.motivation.forEach((val, i) => {
      motivationHTML += `
        <div class="border border-gray-300 bg-white flex items-center justify-center">
          <input type="number" min="1" max="10" value="${val}"
                 class="w-full h-full text-center text-xs focus:outline-none focus:bg-blue-50"
                 onchange="updateMentalState('motivation', ${i}, this.value)">
        </div>`;
    });
    els.motivationRow.innerHTML = motivationHTML;
  }

  // ---------- LOGIC ----------
  function toggleHabit(hIndex, dIndex) {
    habitsData[hIndex].days[dIndex] = !habitsData[hIndex].days[dIndex];
    renderGridStructure();
    updateUI();
    saveState();
  }
  window.toggleHabit = toggleHabit; // expose for onclick

  function updateMentalState(type, index, value) {
    let v = parseInt(value);
    if (isNaN(v)) v = 0;
    v = Math.max(0, Math.min(10, v));
    mentalData[type][index] = v;
    updateCharts();
    saveState();
  }
  window.updateMentalState = updateMentalState;

  function updateUI() {
    let totalHabits = habitsData.length;
    let totalChecks = 0;
    let totalPossible = totalHabits * DAYS_IN_MONTH;

    let dailyStats = Array(DAYS_IN_MONTH)
      .fill(0)
      .map(() => ({ done: 0, total: totalHabits }));

    let habitStats = habitsData.map(h => ({ actual: 0, goal: h.goal }));

    habitsData.forEach((habit, hIndex) => {
      habit.days.forEach((checked, dIndex) => {
        if (checked) {
          totalChecks++;
          dailyStats[dIndex].done++;
          habitStats[hIndex].actual++;
        }
      });
    });

    els.totalHabits.innerText = totalHabits;
    els.completedHabits.innerText = totalChecks;

    const globalPercent = totalPossible
      ? ((totalChecks / totalPossible) * 100).toFixed(2)
      : "0.00";
    els.headerProgressText.innerText = Math.round(globalPercent) + "%";
    els.headerProgressPercent.innerText = globalPercent + "%";
    els.headerProgressBar.style.width = globalPercent + "%";

    let progressHTML = "";
    let doneHTML = "";
    let notDoneHTML = "";

    dailyStats.forEach(stat => {
      const pct = Math.round((stat.done / stat.total) * 100);
      progressHTML += `<div class="border border-gray-300 bg-gray-50 text-center text-[10px] py-1">${pct}%</div>`;
      doneHTML += `<div class="border border-gray-300 text-center text-[10px] py-1">${stat.done}</div>`;
      notDoneHTML += `<div class="border border-gray-300 text-center text-[10px] py-1">${stat.total - stat.done}</div>`;
    });

    els.dailyProgress.innerHTML = progressHTML;
    els.dailyDone.innerHTML = doneHTML;
    els.dailyNotDone.innerHTML = notDoneHTML;

    let analysisHTML = "";
    habitStats.forEach(stat => {
      const pct = Math.min(100, Math.round((stat.actual / stat.goal) * 100));
      analysisHTML += `
        <div class="grid grid-cols-[1fr_1fr_2fr] gap-2 items-center text-xs">
          <div class="text-center">${stat.goal}</div>
          <div class="text-center font-bold">${stat.actual}</div>
          <div class="h-4 bg-gray-200 w-full rounded-sm overflow-hidden">
            <div class="h-full bg-green-400" style="width: ${pct}%"></div>
          </div>
        </div>`;
    });
    els.analysisContainer.innerHTML = analysisHTML;

    updateCharts(dailyStats);
  }

  function updateCharts(dailyStats) {
    if (!dailyStats) return;

    const progressPoints = dailyStats.map((s, i) => ({
      x: i,
      y: s.done / s.total
    }));
    drawChart(els.progressChart, progressPoints, "#4ade80", "#dcfce7");

    const mentalPoints = mentalData.mood.map((m, i) => {
      const avg = (m + mentalData.motivation[i]) / 2;
      return { x: i, y: avg / 10 };
    });
    drawChart(els.mentalChart, mentalPoints, "#f472b6", "#fce7f3");
  }

  function drawChart(svgEl, points, strokeColor, fillColor) {
    const width = svgEl.clientWidth || 1000;
    const height = svgEl.clientHeight || 200;

    const getX = i => (i / (DAYS_IN_MONTH - 1)) * width;
    const getY = v => height - (v * height);

    let d = `M ${getX(0)} ${getY(points[0].y)}`;

    for (let i = 0; i < points.length - 1; i++) {
      const p0 = points[i];
      const p1 = points[i + 1];
      const x0 = getX(p0.x);
      const y0 = getY(p0.y);
      const x1 = getX(p1.x);
      const y1 = getY(p1.y);

      const cpx1 = x0 + (x1 - x0) / 2;
      const cpy1 = y0;
      const cpx2 = x0 + (x1 - x0) / 2;
      const cpy2 = y1;

      d += ` C ${cpx1} ${cpy1}, ${cpx2} ${cpy2}, ${x1} ${y1}`;
    }

    const fillPath = d + ` L ${width} ${height} L 0 ${height} Z`;

    svgEl.innerHTML = `
      <path d="${fillPath}" fill="${fillColor}" opacity="0.5"></path>
      <path d="${d}" fill="none" stroke="${strokeColor}" stroke-width="3" stroke-linecap="round"></path>
    `;
  }

  function init() {
    loadState();
    renderGridStructure();
    renderMentalStateInputs();
    updateUI();
  }

  window.addEventListener("resize", updateUI);
  init();
</script>

</body>
</html>
